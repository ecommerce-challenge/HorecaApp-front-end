<!DOCTYPE HTML>
<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.2/jquery.mobile-1.4.2.min.css">
		<script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
		<script src="http://code.jquery.com/mobile/1.4.2/jquery.mobile-1.4.2.min.js"></script>
		<script type="text/javascript" charset="utf-8" src="cordova.js"></script>
		<script src="http://ec2-54-73-0-85.eu-west-1.compute.amazonaws.com/socket.io/socket.io.js"></script>
		<title>Horeca Activity</title>
		<script>
			var socket;
			var username;
			var password;

			$(document).ready(function()
			{
			 	socket = io.connect("http://ec2-54-73-0-85.eu-west-1.compute.amazonaws.com");
			});

			function login()
			{
				username = $("#username").val();
				password = $("#password").val();
				
				socket.emit("login",
				{
					"username" : username,
					"password" : password
				},
				function(callback)
				{
					if(callback.user != null)
					{
						alert("Hello " + username + "!");
						$.mobile.changePage("#orders");
					}
					else
					{
						alert("You have entered an incorrect username or password");
					}
				});
			}

			function scan()
			{
				cordova.plugins.barcodeScanner.scan(function(result)
				{
					if(result.cancelled != true)
					{
						socket.emit("scanProduct",
						{
							"barcode" : result.text
						},
						function(callback)
						{
							if(callback != null)
							{
								alert("Product found!\n" +
								"Name: " + callback[0].name + "\n" +
								"Price: " + callback[0].price + "\n" +
								"Stock: " + callback[0].quantity);
							}
							else
							{
								alert("The product with barcode: " + result.text + " was not found, please make sure that the barcode isn't damaged.");
							}
						});
					}
				},
				function(error)
				{
					alert("Scanning failed: " + error);
				});
			}
		</script>
	</head>
	<body style="background: rgb(37, 37, 37);">

		<div id="login" data-role="page" data-theme="b">
			<div data-role="header">
				<h1>Login</h1>
			</div>

			<div data-role="main" class="ui-content">
				<p>Please enter your username and password to proceed.</p>
				<div class="ui-field-contain">
					<input id="username" type="text" placeholder="Username">
					<input id="password" type="text" placeholder="Password">
				</div>
				<button class="ui-btn ui-btn-b" onclick="login();">Login</button>
			</div>

			<div data-role="footer">
				<h1>&copy; Delano & Moesjarraf 2014</h1>
			</div>
		</div>

		<div id="orders" data-role="page" data-theme="b">
			<div data-role="header" data-theme="b">
				<h1>Orders</h1>
			</div>

			<div class="ui-content" data-role="main">
				<p>The orders made by your company are shown below.</p>
				<button class="ui-btn ui-btn-b" onclick="scan();">Scan product</button>
			</div>

			<div data-role="footer" data-theme="b">
				<h1>&copy; Delano & Moesjarraf 2014</h1>
			</div>
		</div>

	</body>
</html>